<div class="flex justify-between items-center i-full">
  <div class="flex items-center">
    <span class="font-bold"><%= yield(:page_header) || "Dashboard" %></span>
  </div>

  <div class="flex items-center gap">
    <div class="show@md gap">
      <%= yield :header_action_buttons %>
    </div>

    <div class="flex items-center gap-2">
      <% trigger = button_tag type: "button", class: "btn btn--icon border-0 cursor-pointer hide@md", data: { action: "dialog#showModal" } do %>
        <span class="icon icon--sun icon--color-scheme-light p-3" aria-hidden="true"></span>
        <span class="icon icon--moon icon--color-scheme-dark p-3" aria-hidden="true"></span>
        <span class="sr-only">Theme switcher</span>
      <% end %>

      <%= modal_dialog trigger, title: "Select a theme" do %>
        <div class="menu" data-controller="menu" data-action="keydown->menu#navigate" role="menu">
          <button type="button" class="btn menu__item" data-action="dialog#close color-scheme#setLight" data-menu-target="item" role="menuitem">
            <span class="icon icon--sun"></span> Light
          </button>
          <button type="button" class="btn menu__item" data-action="dialog#close color-scheme#setDark" data-menu-target="item" role="menuitem">
            <span class="icon icon--moon"></span> Dark
          </button>
          <button type="button" class="btn menu__item" data-action="dialog#close color-scheme#setSystem" data-menu-target="item" role="menuitem">
            System
          </button>
        </div>
      <% end %>

      <%# Header Notification Bell (Direct Link for Mobile) %>
      <%= link_to notifications_path, class: "btn btn--icon border-0 cursor-pointer hide@md" do %>
        <div class="relative">
          <span class="icon icon--bell p-3" aria-hidden="true"></span>
          <%# Pass explicit ID suffix for header %>
          <%= render "notifications/badge", unread: current_user.notifications.unread.any?, id_suffix: "header" %>
        </div>
      <% end %>

      <% trigger = button_tag type: "button", class: "btn btn--icon border-0 cursor-pointer hide@md", data: { action: "dialog#showModal" } do %>
        <div class="bg-black rounded-full flex items-center justify-center font-semibold text-reversed" style="block-size: 2rem; inline-size: 2rem;">
          <%= current_user.initials %>
        </div>
      <% end %>

      <%= modal_dialog trigger, title: "Menu", size: '12rem' do %>
        <div class="menu" data-controller="menu" data-action="keydown->menu#navigate" role="menu">
          <span class="inline-flex items-center gap-2 overflow-ellipsis max-i-full font-semibold">
            <span><%= current_user.full_name %></span>
            <% if current_user.verified? %>
              <span class="text-positive" title="Verified Account">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                </svg>
              </span>
            <% end %>
          </span>

          <%= link_to "", class: "btn menu__item", data: { menu_target: "item" }, role: "menuitem" do %>
            <span class="icon icon--shield-user" aria-hidden="true"></span>
            Administration
          <% end %>
          <%= link_to settings_path, class: "btn menu__item", data: { menu_target: "item" }, role: "menuitem" do %>
            <span class="icon icon--settings" aria-hidden="true"></span>
            Settings
          <% end %>
          <%= button_to Current.session, class: "btn menu__item i-full", method: :delete, role: "menuitem" do %>
            <span class="icon icon--log-out" aria-hidden="true"></span>
            Log out
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>