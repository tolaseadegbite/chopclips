<% content_for :title, "Team Members" %>

<div class="container flex flex-col p-4 i-full">
  <div class="flex items-center justify-between mbe-6">
    <div>
      <h2 class="text-2xl font-bold">Team Members</h2>
      <div class="flex items-center gap-2 text-sm text-subtle">
        <span>Manage who has access to this workspace.</span>
        <% if current_role == "Admin" %>
          <%# Seat Counter Badge %>
          <span class="bg-blue-700 text-gray-50 pi-2 pb- rounded-md text-xs font-medium">
            <%= Current.account.seats_used %> / <%= Current.account.seat_limit %> Seats Used
          </span>
        <% end %>
      </div>
    </div>

    <%# --- CONDITIONAL BUTTON --- %>
    <% if Current.account.seat_limit_reached? %>
      <%# Limit Reached: Show Upgrade Button (Placeholder link) %>
      <%= link_to "#billing", class: "btn bg-sky-600 text-gray-50 hover:bg-sky-700 font-semibold rounded-md p-2 flex items-center gap-2 border-0" do %>
        <span class="icon icon--sparkles"></span>
        <span>Upgrade to Pro</span>
      <% end %>
    <% else %>
      <%# Seats Available: Show Invite Button %>
      <%= link_to new_invitation_path, 
                  class: "btn bg-emerald-900 border-0 text-gray-50 hover:bg-green-700", 
                  data: { turbo_frame: "modal" } do %>
        <span class="icon icon--plus"></span>
        <span>Invite Member</span>
      <% end %>
    <% end %>
  </div>

  <%# --- TABS COMPONENT --- %>
  <div class="tabs i-full" data-controller="tabs">
    <div class="tabs__list mbe-4" style="max-inline-size: 400px" role="tablist">
      <button type="button" id="trigger_active" class="btn tabs__button" data-tabs-target="button" data-action="tabs#select" role="tab" aria-controls="tab_active" aria-selected="true">
        Active Members <div class="badge badge--number badge--positive"><%= @active_memberships.count %></div>
      </button>
      <button type="button" id="trigger_pending" class="btn tabs__button" data-tabs-target="button" data-action="tabs#select" role="tab" aria-controls="tab_pending">
        Pending Invites <div class="badge badge--number badge--primary"><%= @pending_invitations.count %></div>
      </button>
    </div>

    <%# --- TAB 1: ACTIVE MEMBERS --- %>
    <div id="tab_active" data-tabs-target="tab" role="tabpanel" aria-labelledby="trigger_active">
      <div class="relative i-full overflow-x-auto border rounded-lg bg-surface">
        <table class="table i-full text-left">
          <thead class="bg-shade font-semibold text-xs uppercase text-subtle">
            <tr>
              <th class="p-3">User</th>
              <th class="p-3">Role</th>
              <th class="p-3">Joined</th>
              <th class="p-3 text-end"></th>
            </tr>
          </thead>
          <tbody id="members-list">
            <%= render partial: "members/membership", collection: @active_memberships %>
          </tbody>
        </table>
      </div>
    </div>

    <%# --- TAB 2: PENDING INVITES --- %>
    <div hidden id="tab_pending" data-tabs-target="tab" role="tabpanel" aria-labelledby="trigger_pending">
      <div class="relative i-full overflow-x-auto border rounded-lg bg-surface">
        <table class="table i-full text-left">
          <thead class="bg-shade font-semibold text-xs uppercase text-subtle">
            <tr>
              <th class="p-3">Email</th>
              <th class="p-3">Role</th>
              <th class="p-3">Sent</th>
              <th class="p-3 text-end"></th>
            </tr>
          </thead>
          <tbody id="invitations-list">
            <% if @pending_invitations.any? %>
              <%= render partial: "invitations/invitation", collection: @pending_invitations %>
            <% else %>
              <tr>
                <td colspan="4" class="p-8 text-center text-subtle text-sm">No pending invitations.</td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>